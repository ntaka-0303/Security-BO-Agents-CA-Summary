# 仕様書

## 1. 概要
* **ドキュメント名**：仕様書
* **対象機能**：F-006 リスク判定ロジック
* **対応する機能要件**：機能要件定義書 F-006、機能詳細 3.6
* **担当者**：データアナリティクスチーム
* **前提条件**：CANOTICE・DRAFT_VERSION の最新データ取得可能
* **制約条件**：リアルタイム応答（<1s）、スコアリングルールは PoC 固定

---

## 2. 画面仕様
UI なし（結果は UI-CA-003 表示）

---

## 3. 処理仕様

### 3.1 処理概要
```
1. CA 属性取得（CA_NOTICE、AI_OUTPUT）
2. 過去アラート参照（AUDIT_LOG/履歴）
3. スコアリング（イベント種別点 + 金額点 + ヒストリ点）
4. リスクフラグ判定 (>=70 高リスク, 50-69 要注意)
5. 判定結果を DRAFT_VERSION に書き込み
```

### 3.2 処理詳細
| 手順 | 内容 | 入力 | 出力 |
| -- | -- | -- | -- |
| 1 | データ集約 | ca_notice_id | feature set |
| 2 | スコア計算 | feature set | score |
| 3 | 判定 | score | flag(Y/N), reasons |
| 4 | 保存 | flag | DRAFT_VERSION 更新 |

### 3.3 業務ルール
* イベント種別ポイント：配当=20、増資=40、株式分割=15
* 金額ポイント：支払総額 >10億=40、>1億=20
* 過去誤り履歴（同銘柄 3 ヶ月以内）+20
* スコア >=70: `risk_flag=Y`、承認必須
* 50〜69: フラグ `Y?` 選択可能（UI で切替）

### 3.4 例外処理
* 必要データ不足→`status=pending` として UI に警告
* スコア計算失敗→デフォルトで `risk_flag=N` だがアラート送信

---

## 4. API / 外部連携
なし（内部ロジック）

---

## 5. データ仕様

### 5.1 データ項目
| No | 論理名 | 物理名 |
| -- | -- | -- |
| D-002 | 銘柄コード | security_code |
| D-003 | CA種別 | ca_event_type |
| D-010 | リスクフラグ | risk_flag |

### 5.2 テーブル
* **DRAFT_VERSION**（risk_flag, reason_code）
* **AUDIT_LOG**（過去アラート参照）

---

## 6. シーケンス図
```
Draft Save → リスク判定 → DRAFT_VERSION 更新 → UI 反映
```

