# 機能要件定義書：CA 情報要約・通知文ドラフト生成エージェント

## 1. 前提・背景

* **対象業務**: コーポレートアクション（CA）通知をもとに社内要約および顧客向け通知ドラフトを作成するバックオフィス業務
* **関連する業務詳細書**: `業務要件定義書_CA_summary_agent.md`
* **開発対象範囲（In Scope）**:
  - CA 通知原文・銘柄情報の入力 UI／API
  - CA 管理システム（S-001）とのデータ連携
  - AI エージェント基盤（S-002）による要約・ドラフト生成
  - 担当者レビュー／修正 UI（P-005）
  - 高リスク案件判断ロジックと上長承認フロー連携
  - 通知配信システム（S-003）への確定文連携と監査ログ
* **対象外（Out of Scope）**:
  - OCR 等による紙・画像からのテキスト化
  - 通知配信チャネル（郵送/電子交付）側の実装
  - 本番データを用いた継続学習やモデルチューニング
* **前提条件**:
  - CA 通知原文はテキスト化済みで担当者が取得できる
  - AI モデルは社内標準テンプレートと用語ルールを学習済み PoC 環境を用いる
  - ユーザーは社内認証を通過し、権限管理は既存 ID 管理に委譲
* **制約条件**:
  - PoC 環境内の限定データのみ利用可（個人情報は匿名化サンプル）
  - 最終通知確定および顧客送付は必ず人手を介す
  - 生成 AI の出力はすべてバージョン管理・再現可能ログを保持

---

## 2. 機能一覧

| No.   | 対応プロセス（P-XXX） | 機能名称  | 種別（画面/UI・API・内部処理） | 概要   |
| ----- | ------------- | ----- | ------------------ | ---- |
| F-001 | P-001         | CA通知取込管理 UI | 画面/UI | CA 通知原文と付随ファイルを登録し、担当者にアサインする |
| F-002 | P-002         | CA管理システム連携 API | API | S-001 から銘柄情報・重要日付を取得し案件情報へ反映 |
| F-003 | P-003         | AI 入力オーケストレーション | 内部処理 | 原文・銘柄・テンプレ条件を組み合わせ、S-002 へ送信 |
| F-004 | P-004         | 要約・ドラフト生成エージェント | 内部処理 | CA 内容解析・社内要約・顧客向けドラフトを生成 |
| F-005 | P-005         | ドラフトレビュー UI | 画面/UI | 生成文と原文比較、修正、コメント、バージョン保存を行う |
| F-006 | P-005         | リスク判定ロジック | 内部処理 | イベント種別・金額等に基づき高リスク判定を自動実施 |
| F-007 | P-006         | 上長承認ワークフロー連携 | 画面/UI | 承認依頼通知、承認／差戻し、コメント記録を提供 |
| F-008 | P-007         | 通知配信システム連携 API | API | 確定通知文を S-003 へ送信し配信ステータスを取得 |
| F-009 | 全体          | 監査ログ／バージョン管理 | 内部処理 | 入出力、修正履歴、承認ログを保持し追跡可能性を確保 |

---

## 3. 機能詳細
別紙参照  
**機能一覧の各機能について `Template/機能詳細_テンプレート.md` を用いて別途作成する。**

---

## 4. データ項目定義（Data Dictionary）

| No    | データ項目名 | 物理名           | 型       | 桁数 | Nullable | 説明   |
| ----- | ------------ | --------------- | -------- | ---- | -------- | ---- |
| D-001 | CA通知ID | ca_notice_id | varchar | 64 | NOT NULL | CA 管理システムから受領する一意キー |
| D-002 | 銘柄コード | security_code | varchar | 10 | NOT NULL | 4桁/6桁コード、前ゼロ含む |
| D-003 | CA種別 | ca_event_type | varchar | 32 | NOT NULL | 配当、株式分割等の分類 |
| D-004 | 権利確定日 | record_date | date | - | NOT NULL | 権利付き最終日の翌営業日等 |
| D-005 | 支払開始日 | payment_date | date | - | NULLABLE | 未定の場合あり |
| D-006 | 原文テキスト | notice_text | text | - | NOT NULL | CA 通知原文（テキスト化済み） |
| D-007 | 社内要約 | internal_summary | text | - | NULLABLE | F-004 生成の社内向け要約 |
| D-008 | 顧客向けドラフト | customer_draft | text | - | NULLABLE | 生成ドラフトまたは修正後文面 |
| D-009 | バージョン番号 | draft_version | int | - | NOT NULL | 修正保存ごとにインクリメント |
| D-010 | リスク判定フラグ | risk_flag | char | 1 | NOT NULL | Y/N で高リスクかを保持 |
| D-011 | 承認ステータス | approval_status | varchar | 16 | NOT NULL | `pending/approved/rejected` 等 |
| D-012 | 監査ログID | audit_id | varchar | 64 | NOT NULL | 入出力・承認トレース用 ID |

---

## 5. ER図・テーブル定義（必要に応じて）

* ER図（別紙: CA_summary_ER.drawio 予定）
* テーブル定義（CA通知基本テーブル、生成ドラフト履歴テーブル、監査ログテーブル）  
  ※詳細はデータモデリングフェーズで追記。

---

## 6. 関連資料

* `業務要件定義書_CA_summary_agent.md`
* `CA_summary_flow.drawio`
* `04_usecase_CA_summary_agent.md`

